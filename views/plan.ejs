<!-- This page shows a single Plan for Editing and starting the auto-fill
    ejs variables: plan, doctors, wishLists, wishlist
 -->
<%- include("header") -%>
<%const week = ["Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag"]%>
<h1>Dienstplan</h1>
<h2><%= plan.name%> - <%= plan.month%>/<%= plan.year%></h2>

<table class="table table-bordered plan-table">
    <thead>
        <tr>
            <th>Datum</th>
            <th>Wochentag</th>
            <th>NFA</th>
            <th>Haus</th>
            <th>IMC</th>
            <th>Notarzt</th>
            <th>RTH</th>
        </tr>
    </thead>
    <tbody>
        <%plan.days.forEach(day => {%>
            <tr <%if(day.noWorkingDay){%>class="table-secondary" <%}%>>
                <td><%= day.date.getDate()%></td>
                <td><%= week[day.date.getDay()]%></td>
                <td><a tabindex="0" class="popover-toggle" data-toggle="popover" data-placement="bottom" data-title="" data-container="body" data-date="<%= day.date.getDate()%>"></a></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>

            <%if(available){%>
            <div id="popover-content-<%= day.date.getDate()%>" class="hide">
                <form id="myform" class="form-inline" role="form">
                <p>select two for shared duty</p>
                <select id="emergency-department-first-<%= day.date.getDate()%>" class="form-select new-plan-form-select">
                    <option value="0" selected> </option>
                    <%available[String(day.date.getDate())].emergencyDepartment.forEach(doctor => {%>  
                        <option value="<%= doctor[0]%>"><%= doctor[1]%></option>
                    <%})%>
                </select>
                <select id="emergency-department-second-<%= day.date.getDate()%>" class="form-select new-plan-form-select">
                    <option value="0"> </option>
                    <%available[String(day.date.getDate())].emergencyDepartment.forEach(doctor => {%>  
                        <option value="<%= doctor[0]%>"><%= doctor[1]%></option>
                    <%})%>
                </select>
                <br>
                <br>
            <button type="submit" data-duty="emergency-department" data-date="<%= day.date.getDate()%>" class="bnt btn-success popover-btn" >OK</button>
        </form>
            </div>
            <%}%>
        <%})%>

    </tbody>


</table>



<select class="form-select plan-wish-select" data-planId="<%= plan._id%>">
    <%if (available){%>
        <option value="<%= available.id%>"><%= available.name%></option>
    <%}else{ %>
        <option value="0">Wunschliste auswählen</option>
    <%}%>
    <%wishLists.forEach(wishLi => { %>
        <% if(wishLi.year == plan.year && wishLi.month == plan.month){%>
            <option value="<%= wishLi._id%>"><%= wishLi.name%></option>
        <% } %>
    <% })%>
</select>
<br>
<br>
<button class="btn btn-info">Wünsche eintragen</button>
<br>
<br>
<button class="btn btn-warning">Automatisch auffüllen</button>
<br>
<br>
<button class="btn btn-success">Speichern</button>



<%- include("footer") -%>




